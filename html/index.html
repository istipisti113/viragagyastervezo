<!DOCTYPE html>
<html>

  <head>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="asd.js" defer></script>
    <script src="script.js" defer></script>
  </head>

  <body>
    <div id="container">
      <div id="sidepanel">
        <div class="sidepanel-header">
          <i class="fas fa-leaf"></i> Kerttervez≈ë
        </div>

        <div class="sidepanel-buttons">
          <button class="sidepanel-btn trigger_btn" id="open_popup">
            <i class="fas fa-database"></i> Adatok
          </button>
          <button class="sidepanel-btn trigger_btn" id="open_info_popup">
            <i class="fas fa-info-circle"></i> Info
          </button>
          <button class="sidepanel-btn trigger_btn" id="open_about_popup">
            <i class="fas fa-users"></i> R√≥lunk
          </button>
          <button class="sidepanel-btn trigger_btn" id="save_garden">
            <i class="fas fa-save"></i> Kert ment√©se
          </button>
          <button class="sidepanel-btn trigger_btn" id="load_garden">
            <i class="fas fa-folder-open"></i> Kert bet√∂lt√©se
          </button>
          <button class="sidepanel-btn trigger_btn" id="export_garden">
            <i class="fas fa-download"></i> Export√°l√°s
          </button>
        </div>

        <div class="sidepanel-footer">
          Kerttervez≈ë v1.0<br>
          <small>&copy; 2025</small>
        </div>
      </div>

      <div id="elvalaszto">
      </div>

      <div id="main">
        <div style="display: block; margin-top: 30px; width: 980px; height: 810px; margin-left: 180px;">
          <canvas id="c"></canvas>
        </div>
        <!-- Adatok popup -->
        <div class="popup_overlay" id="popup_overlay">
          <div class="popup">
            <button class="close_btn" id="close_popup">&times;</button>

            <div class="popup_header">
              <h2>√údv√∂z√∂lj√ºk!</h2>
            </div>

            <div class="popup_content">
              <p>Mekkora ter√ºletet szeretne tervezni?</p>
              <input type="text" id="area_input" placeholder="Hossz (m√©ter)">
              <input type="text" id="width_input" placeholder="Sz√©less√©g (m√©ter)">
              <div id="error_message" class="error_message"></div>
              <p>Milyen fajt√°j√∫ n√∂v√©nyeket szeretne √ºltetni?(v√°lasszon a leg√∂r√ºl≈ë list√°b√≥l, t√∂bbet is kijel√∂lhet)</p>
              <select id="plant_select">
              </select><br>
              <select id="fajta_select">
              </select><br>
              <input type="number" min="0" name="mennyi" placeholder="mennyit szeretne belole" id="mennyi">
              
              <button id="add">hozzaadas</button> <br>
              <script>
                let selectedPlants = [];

                // Hozz√°ad√°s gomb referencia (az els≈ë gomb, ami a hozz√°ad√°s√©rt felel)
                const addButton = document.querySelector('#add');
                const planButton = document.querySelectorAll('button')[1];

                // F≈ë input mez≈ëk
                const areaInput = document.getElementById('area_input');
                const widthInput = document.getElementById('width_input');
                const errorMessageDiv = document.getElementById('error_message');
                const plantSelectionErrorDiv = document.getElementById('plant_selection_error');

                // Hozz√°ad√°si logika
                addButton.addEventListener('click', function() {
                    const plantSelect = document.getElementById('plant_select');
                    const fajtaSelect = document.getElementById('fajta_select');
                    const mennyiInput = document.getElementById('mennyi');
                    
                    // Ellen≈ërizz√ºk, hogy a kiv√°lasztott n√∂v√©ny valid-e
                    const selectedPlantValue = plantSelect.value;
                    const selectedFajtaValue = fajtaSelect.value;
                    const selectedQuantity = parseInt(mennyiInput.value);
                    
                    // Valid√°ci√≥
                    if (!selectedPlantValue || !selectedFajtaValue || isNaN(selectedQuantity) || selectedQuantity <= 0) {
                        errorMessageDiv.textContent = "K√©rj√ºk, t√∂lts√∂n ki minden mez≈ët helyesen a n√∂v√©ny hozz√°ad√°s√°hoz!";
                        return;
                    }
                    
                    // Hiba√ºzenet t√∂rl√©se
                    errorMessageDiv.textContent = '';
                    
                    // √öj n√∂v√©ny objektum l√©trehoz√°sa
                    const newPlant = {
                        plantType: selectedPlantValue,
                        variety: selectedFajtaValue,
                        quantity: selectedQuantity,
                        id: Date.now() // Egyedi azonos√≠t√≥
                    };
                    
                    // Hozz√°ad√°s a t√∂mbh√∂z
                    selectedPlants.push(newPlant);
                    
                    // Friss√≠tj√ºk a megjelen√≠t√©st
                    updatePlantList();
                    
                    // Mez≈ëk √ºr√≠t√©se
                    mennyiInput.value = '';
                    plantSelectionErrorDiv.textContent = ''; // T√∂r√∂lj√ºk a tervez√©si hib√°t is
                    
                    console.log("Hozz√°adott n√∂v√©nyek:", selectedPlants);
                });

                // Tervez√©s gomb esem√©nykezel≈ëje - CSAK a valid√°l√°s
                planButton.addEventListener('click', function() {
                    // Els≈ë k√∂rben ellen≈ërizz√ºk a ter√ºlet mez≈ëket
                    const length = parseFloat(areaInput.value);
                    const width = parseFloat(widthInput.value);
                    
                    errorMessageDiv.textContent = '';
                    plantSelectionErrorDiv.textContent = '';
                    
                    // Ter√ºlet valid√°ci√≥
                    if (isNaN(length) || length <= 0 || isNaN(width) || width <= 0) {
                        errorMessageDiv.textContent = "K√©rj√ºk, t√∂ltse ki helyesen a ter√ºlet mez≈ëket (pozit√≠v sz√°mok)!";
                        return;
                    }
                    
                    // N√∂v√©ny valid√°ci√≥
                    if (selectedPlants.length === 0) {
                        plantSelectionErrorDiv.textContent = "K√©rj√ºk, adjon hozz√° legal√°bb egy n√∂v√©nyt a tervez√©shez!";
                        return;
                    }
                    
                    // Ha minden valid, akkor jelen√≠ts√ºk meg a mennyis√©g beviteli r√©szt
                    showQuantitySection();
                });

                // N√∂v√©nyek list√°j√°nak friss√≠t√©se
                function updatePlantList() {
                    const list = document.querySelector('ul');
                    list.innerHTML = '';
                    
                    selectedPlants.forEach(plant => {
                        const li = document.createElement('li');
                        li.setAttribute('data-id', plant.id);
                        li.textContent = `${plant.plantType} - ${plant.variety}: ${plant.quantity} db`;
                        
                        // T√∂rl√©s gomb
                        const deleteBtn = document.createElement('button');
                        deleteBtn.textContent = 'T√∂rl√©s';
                        deleteBtn.addEventListener('click', function() {
                            selectedPlants = selectedPlants.filter(p => p.id !== plant.id);
                            updatePlantList();
                        });
                        
                        li.appendChild(deleteBtn);
                        list.appendChild(li);
                    });
                    
                    // A hozz√°ad√°s gomb mindig l√°that√≥ marad
                    addButton.style.display = 'inline-block';
                }

                // Mennyis√©gi r√©sz megjelen√≠t√©se
                function showQuantitySection() {
                    const plantQuantitySection = document.getElementById('plant_quantity_section');
                    const plantQuantityInputs = document.getElementById('plant_quantity_inputs');
                    
                    // T√∂r√∂lj√ºk a kor√°bbi tartalmat
                    plantQuantityInputs.innerHTML = '';
                    
                    // Mennyis√©gi mez≈ëk l√©trehoz√°sa minden kiv√°lasztott n√∂v√©nyhez
                    selectedPlants.forEach(plant => {
                        const div = document.createElement('div');
                        div.className = 'quantity_input';
                        
                        const label = document.createElement('label');
                        label.textContent = `${plant.plantType} - ${plant.variety}: `;
                        
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.min = '0';
                        input.value = plant.quantity;
                        input.dataset.plantId = plant.id;
                        
                        div.appendChild(label);
                        div.appendChild(input);
                        plantQuantityInputs.appendChild(div);
                    });
                    
                    // Megjelen√≠tj√ºk a mennyis√©gi r√©szt
                    plantQuantitySection.style.display = 'block';
                    
                    // Inicializ√°ljuk a tervez√©si logik√°t
                    initPlanning();
                }

                // Tervez√©s v√©gleges√≠t√©se
                function initPlanning() {
                    // A mennyis√©gi r√©szen bel√ºli tervez√©s gomb keres√©se
                    // Ha nincs, akkor l√©trehozunk egyet
                    let finalPlanButton = plantQuantitySection.querySelector('button');
                    
                    if (!finalPlanButton) {
                        finalPlanButton = document.createElement('button');
                        finalPlanButton.textContent = 'Terv elk√©sz√≠t√©se';
                        plantQuantitySection.appendChild(finalPlanButton);
                        
                        finalPlanButton.addEventListener('click', function() {
                            // √ñsszegy≈±jtj√ºk a megadott mennyis√©geket
                            const quantityInputs = document.querySelectorAll('#plant_quantity_inputs input[type="number"]');
                            let allValid = true;
                            
                            quantityInputs.forEach(input => {
                                const value = parseInt(input.value);
                                const plantId = parseInt(input.dataset.plantId);
                                
                                if (isNaN(value) || value < 0) {
                                    document.getElementById('quantity_error_message').textContent = 
                                        "K√©rj√ºk, adjon meg √©rv√©nyes mennyis√©geket (0 vagy nagyobb)!";
                                    allValid = false;
                                    return;
                                }
                                
                                // Friss√≠tj√ºk a n√∂v√©ny mennyis√©g√©t
                                const plantIndex = selectedPlants.findIndex(p => p.id === plantId);
                                if (plantIndex !== -1) {
                                    selectedPlants[plantIndex].quantity = value;
                                }
                            });
                            
                            if (!allValid) return;
                            
                            // T√∂r√∂lj√ºk a hib√°t
                            document.getElementById('quantity_error_message').textContent = '';
                            
                            // Itt folytathatod a tervez√©st - p√©ld√°ul k√ºld√©s szervernek vagy megjelen√≠t√©s
                            console.log("V√©gleges tervez√©s:", {
                                terulet: {
                                    hossz: parseFloat(areaInput.value),
                                    szelesseg: parseFloat(widthInput.value)
                                },
                                novenyek: selectedPlants
                            });
                            
                            // Sikeres √ºzenet
                            alert("A tervez√©s sikeresen elk√©sz√ºlt!");
                        });
                    }
                }
              </script>
              <ul>
              </ul>

              <button>Tervez√©s</button>
              <div id="plant_selection_error" class="error_message"></div>
              <div id="plant_quantity_section" style="display:none;">

                <p>Mennyit szeretne √ºltetni a k√ºl√∂nb√∂z≈ë kiv√°lasztott n√∂v√©nyekb≈ël(v)?</p>
                <div id="plant_quantity_inputs" class="plant_quantity_inputs"></div>
                <div id="quantity_error_message" class="error_message"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Info popup -->
        <div class="popup_overlay" id="info_popup_overlay">
          <div class="popup">
            <button class="close_btn" id="close_info_popup">&times;</button>

            <div class="popup_header">
              <h2>Inform√°ci√≥k</h2>
            </div>

            <div class="popup_content">
              <p>
                √údv√∂z√∂lj√ºk a Kerttervez≈ëben! üè°<br>
                Ez az alkalmaz√°s seg√≠t neked megtervezni √°lmaid kertj√©t egyszer≈±en √©s gyorsan. Itt mindent megtal√°lsz,
                amire sz√ºks√©ged van a t√∂k√©letes kert kialak√≠t√°s√°hoz!<br>
                üìê Mit tudsz csin√°lni?<br>
                üñºÔ∏è KERTM√âRET MEGAD√ÅSA<br>

                üå∏ N√ñV√âNYEK KIV√ÅLASZT√ÅSA<br>

                üî¢ MENNYIS√âGEK MEGAD√ÅSA<br>

                ‚ú® AUTOMATIKUS TERVK√âSZ√çT√âS<br>

                üéØ Mire sz√°m√≠thatsz? <br>
                ‚úÖ Okos javaslatok - mely n√∂v√©nyek illenek √∂ssze<br>
                ‚úÖ Ter√ºlet sz√°m√≠t√°s - pontosan l√°tod, mennyi helyre van sz√ºks√©ged<br>
                ‚úÖ Vizu√°lis terv - √°ttekinthet≈ë elrendez√©s<br>
                ‚úÖ Figyelmeztet√©sek - ha valami nem optim√°lis<br>
                ‚úÖ Menthet≈ë tervek - k√©s≈ëbb visszat√©rhetsz hozz√°juk<br>

                üöÄ Kezdj√ºk el!<br>
                Kattints a "Adatok" gombra<br>
                Add meg a kert m√©reteit<br>
                V√°laszd ki a kedvenc n√∂v√©nyeidet<br>
                Add meg a darabsz√°mokat<br>
                Kapsz egy sz√©p kerttervet!
              </p>
            </div>
          </div>
        </div>

        <div class="popup_overlay" id="about_popup_overlay">
          <div class="popup">
            <button class="close_btn" id="close_about_popup">&times;</button>

            <div class="popup_header">
              <h2>Fejleszt≈ëk:</h2>
            </div>

            <div class="popup_content">
              <p>Szab√≥ Istv√°n</p>
              <p>Szab√≥ Botond</p>
              <p>Bogn√°r M√°t√© Zsolt</p>
              <div style="text-align: center; margin-top: 30px;">
                <i class="fas fa-seedling" style="font-size: 3rem; color: #8D6E63;"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Kert ment√©se popup -->
        <div class="popup_overlay" id="save_popup_overlay">
          <div class="popup">
            <button class="close_btn" id="close_save_popup">&times;</button>

            <div class="popup_header">
              <h2>Kert ment√©se</h2>
            </div>

            <div class="popup_content">
              <p>Add meg a kert nevet:</p>
              <input type="text" id="garden_name" placeholder="Kert neve">
              <div id="save_error_message" class="error_message"></div>
              <p>A kert terve el lesz mentve, hogy k√©s≈ëbb visszat√©rhess hozz√°.</p>
            </div>
          </div>
        </div>

        <!-- Kert bet√∂lt√©se popup -->
        <div class="popup_overlay" id="load_popup_overlay">
          <div class="popup">
            <button class="close_btn" id="close_load_popup">&times;</button>

            <div class="popup_header">
              <h2>Kert bet√∂lt√©se</h2>
            </div>

            <div class="popup_content">
              <p>V√°lassz egy kor√°bban mentett kertet:</p>
              <select id="saved_gardens">
                <option value="">-- V√°lassz egy kertet --</option>
              </select>
              <div id="load_error_message" class="error_message"></div>
            </div>
          </div>
        </div>

        <!-- Export√°l√°s popup -->
        <div class="popup_overlay" id="export_popup_overlay">
          <div class="popup">
            <button class="close_btn" id="close_export_popup">&times;</button>

            <div class="popup_header">
              <h2>Export√°l√°s</h2>
            </div>

            <div class="popup_content">
              <p>V√°laszd ki az export√°l√°s form√°tum√°t:</p>
              <select id="export_format">
                <option value="pdf">PDF dokumentum</option>
                <option value="image">K√©p (PNG)</option>
                <option value="text">Sz√∂veges form√°tum</option>
              </select>
              <div id="export_error_message" class="error_message"></div>
              <p>A kert terve export√°lva lesz a v√°lasztott form√°tumban.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
